<!doctype html><html lang=zh class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.81.0"><link rel=canonical type=text/html href=https://kubecube-io.github.io/docs/user-guide/administration/><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>运维管理 | KubeCube</title><meta name=description content="开源容器平台"><meta property="og:title" content="运维管理"><meta property="og:description" content="开源容器平台"><meta property="og:type" content="website"><meta property="og:url" content="https://kubecube-io.github.io/docs/user-guide/administration/"><meta property="og:site_name" content="KubeCube"><meta itemprop=name content="运维管理"><meta itemprop=description content="开源容器平台"><meta name=twitter:card content="summary"><meta name=twitter:title content="运维管理"><meta name=twitter:description content="开源容器平台"><link rel=preload href=/scss/main.min.810b672b8acd789a78e1ee9e004e599d749572bd1fbb0d001f26f2e5c568c907.css as=style><link href=/scss/main.min.810b672b8acd789a78e1ee9e004e599d749572bd1fbb0d001f26f2e5c568c907.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script src=https://unpkg.com/lunr@2.3.8/lunr.min.js integrity=sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY crossorigin=anonymous></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><svg width="4984" height="1e3" viewBox="0 0 4984 1e3" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3551.54 432.823C3552.84 435.556 3555.59 437.298 3558.62 437.298H3658.46C3663.69 437.298 3667.45 432.277 3665.98 427.259 3634.56 319.831 3535.31 241.352 3417.7 241.352H3402.03c-142.85.0-258.65 115.801-258.65 258.648v31.352c0 142.847 115.8 258.648 258.65 258.648H3417.7c117.61.0 216.86-78.48 248.28-185.907C3667.45 599.075 3663.69 594.054 3658.46 594.054H3558.62C3555.59 594.054 3552.84 595.796 3551.54 598.529 3526.37 651.507 3472.39 688.108 3409.87 688.108 3323.29 688.108 3253.11 617.926 3253.11 531.352V5e2C3253.11 413.426 3323.29 343.243 3409.87 343.243c62.52.0 116.5 36.601 141.67 89.58z" fill="#333"/><path fill-rule="evenodd" clip-rule="evenodd" d="M4970.89 651.516C4972.68 646.419 4968.9 641.081 4963.5 641.081H4867.67C4865.09 641.081 4862.68 642.35 4861.21 644.474 4842.85 671.15 4813.84 688.108 4781.45 688.108 4736.6 688.108 4698.03 655.443 4685.65 609.73h288.5C4978.15 609.73 4981.51 606.719 4981.95 602.744 4982.82 594.747 4983.27 586.616 4983.27 578.378c0-116.507-90-211.621-201.820000000001-211.621-111.83.0-201.83 95.114-201.83 211.621S4669.62 790 4781.45 790C4868.6 790 4942.57 732.144 4970.89 651.516zM4781.45 468.649C4819.59 468.649 4853.14 492.229 4869.98 527.433H4692.92C4709.75 492.229 4743.3 468.649 4781.45 468.649z" fill="#333"/><path d="M3727 386C3727 381.582 3730.58 378 3735 378h86C3825.42 378 3829 381.582 3829 386V612.5C3829 654.197 3862.8 688 3904.5 688s75.5-33.803 75.5-75.5V386C3980 381.582 3983.58 378 3988 378h86C4078.42 378 4082 381.582 4082 386V770C4082 774.418 4078.42 778 4074 778h-86C3983.58 778 3980 774.418 3980 770V764.6C3954.53 780.689 3924.35 790 3892 790 3800.87 790 3727 716.127 3727 625V386z" fill="#333"/><path fill-rule="evenodd" clip-rule="evenodd" d="M3072.22 651.516C3074.01 646.419 3070.22 641.081 3064.82 641.081H2968.99C2966.42 641.081 2964 642.35 2962.54 644.474 2944.17 671.15 2915.17 688.108 2882.77 688.108 2837.92 688.108 2799.35 655.443 2786.97 609.73h288.51C3079.48 609.73 3082.84 606.719 3083.27 602.744 3084.15 594.747 3084.59 586.616 3084.59 578.378c0-116.507-90-211.621-201.82-211.621s-201.82 95.114-201.82 211.621S2770.95 790 2882.77 790C2969.93 790 3043.9 732.144 3072.22 651.516zM2882.77 468.649C2920.92 468.649 2954.47 492.229 2971.3 527.433H2794.24C2811.07 492.229 2844.62 468.649 2882.77 468.649z" fill="#333"/><path d="M1342 770.243C1342 774.661 1345.58 778.243 1350 778.243H1435.89c4.41999999999985.0 8-3.58200000000011 8-8V592.206L1495.37 540.725l196.9 234.656C1693.79 777.193 1696.04 778.239 1698.4 778.239h112.12C1817.32 778.239 1821.02 770.302 1816.65 765.096L1567.7 468.401l244.74-244.744C1817.48 218.617 1813.91 210 1806.78 210H1685.31C1683.19 210 1681.16 210.843 1679.66 212.343L1443.89 448.109V218C1443.89 213.582 1440.31 210 1435.89 210H1350C1345.58 210 1342 213.582 1342 218V770.243z" fill="#333"/><path d="M1828 386C1828 381.582 1831.58 378 1836 378h86C1926.42 378 1930 381.582 1930 386V612.5c0 41.697 33.8 75.5 75.5 75.5s75.5-33.803 75.5-75.5V386C2081 381.582 2084.58 378 2089 378h86C2179.42 378 2183 381.582 2183 386V770C2183 774.418 2179.42 778 2175 778h-86C2084.58 778 2081 774.418 2081 770V764.6C2055.53 780.689 2025.35 790 1993 790 1901.87 790 1828 716.127 1828 625V386z" fill="#333"/><path fill-rule="evenodd" clip-rule="evenodd" d="M2254 210C2249.58 210 2246 213.582 2246 218V770C2246 774.418 2249.58 778 2254 778h86C2344.42 778 2348 774.418 2348 770V757.487C2378.39 778.082 2414.4 790 2453 790c108.8.0 197-94.692 197-211.5S2561.8 367 2453 367C2414.4 367 2378.39 378.918 2348 399.513V218C2348 213.582 2344.42 210 2340 210h-86zm94 368.5c0 60.475 44.77 109.5 1e2 109.5s1e2-49.025 1e2-109.5S2503.23 469 2448 469s-1e2 49.025-1e2 109.5z" fill="#333"/><path fill-rule="evenodd" clip-rule="evenodd" d="M4153 210C4148.58 210 4145 213.582 4145 218V770C4145 774.418 4148.58 778 4153 778h86C4243.42 778 4247 774.418 4247 770V757.487C4277.39 778.082 4313.4 790 4352 790c108.8.0 197-94.692 197-211.5S4460.8 367 4352 367C4313.4 367 4277.39 378.918 4247 399.513V218C4247 213.582 4243.42 210 4239 210h-86zm94 368.5C4247 638.975 4291.77 688 4347 688s1e2-49.025 1e2-109.5S4402.23 469 4347 469s-1e2 49.025-1e2 109.5z" fill="#333"/><path d="M554.586 39C564.593 21.6667 552.084.0 532.069.0H346.41c-35.726.0-68.739 19.0599-86.602 50L28.8676 450C11.0043 480.94 11.0042 519.06 28.8675 550L259.808 950C277.671 980.94 310.684 1e3 346.41 1e3H447.276C456.208 1e3 464.461 995.235 468.927 987.5L612.399 739C622.406 721.667 609.897 7e2 589.882 7e2H427.239C412.949 7e2 399.743 692.376 392.598 680L300.222 520C293.077 507.624 293.077 492.376 300.222 480l85.964-148.894L386 330.999 554.586 39z" fill="#0056ff"/><path d="M564.401 3e2C544.386 3e2 531.877 278.333 541.884 261L685.356 12.5C689.822 4.76496 698.075.0 707.006.0H808.29C844.017.0 877.03 19.06 894.893 50.0001L1125.83 450C1143.7 480.94 1143.7 519.06 1125.83 550L894.893 950C877.03 980.94 844.017 1e3 808.29 1e3H622.214C602.199 1e3 589.69 978.333 599.697 961L750.385 7e2H750.555L854.478 520C861.624 507.624 861.624 492.376 854.478 480L762.102 320C754.957 307.624 741.752 3e2 727.461 3e2H564.401z" fill="#0056ff"/></svg></span><span class="text-uppercase font-weight-bold">KubeCube</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/docs/><span class=active>文档</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/blog/><span>博客</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://github.com/kubecube-io/kubecube target=_blank><i class="fab fa-github"></i><span>GitHub</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; 站内搜索…" aria-label=站内搜索… autocomplete=off data-offline-search-index-json-src=/offline-search-index.d5a631f6a2fe4c00c21a0bc429b81434.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>这是本节的多页打印视图。
<a href=# onclick="return print(),!1">点击此处打印</a>.</p><p><a href=/docs/user-guide/administration/>返回本页常规视图</a>.</p></div><h1 class=title>运维管理</h1><ul><li>1: <a href=#pg-882b3bb80d835340e02c570d9efc20ee>用户管理</a></li><li>2: <a href=#pg-cc16e9ac86342c7d9c5ab1f4a64571b9>租户管理</a></li><li>3: <a href=#pg-e2d94e3b74b28c3cb9df52bbf9ca00b2>角色管理</a></li><li>4: <a href=#pg-0a268df46e46cb89462ce4c8762d20b6>配额管理</a></li><li>5: <a href=#pg-2306a8e0d2dc86a646a28d1621010f14>K8s集群管理</a></li><ul><li>5.1: <a href=#pg-62bae3e56f26c43c795878e3d6435987>多集群管理</a></li><li>5.2: <a href=#pg-5b8c71fac214fcac2dcfe6ebb573c677>集群级资源管理</a></li><ul><li>5.2.1: <a href=#pg-b58c5b5952e588cce8ddd5fcb7b7c0cc>存储类别(StorageClass)</a></li><li>5.2.2: <a href=#pg-84021fcd47af24336b3f2fa251e11490>存储声明(PV)</a></li><li>5.2.3: <a href=#pg-2faeb51dc0a9f8f4133fba56d59316c3>集群节点(Node)</a></li><li>5.2.4: <a href=#pg-cb1dd5ef4d6788bbe75c885d770b9a12>网络策略(NetworkPolicy)</a></li></ul></ul><li>6: <a href=#pg-4de4ac3e2c973d54322dc28a04e64999>操作审计</a></li></ul><div class=content></div></div><div class=td-content><h1 id=pg-882b3bb80d835340e02c570d9efc20ee>1 - 用户管理</h1><p>本文档介绍了如何在 KubeCube 上创建、管理用户。</p><h2 id=准备工作>准备工作</h2><p>使用平台管理员账号登录 KubeCube。</p><h2 id=新增用户>新增用户</h2><p>1、使用平台管理员账号登录 KubeCube 后，展开【组织管理】菜单，点击【用户管理】，进入用户管理页面。</p><p><img src=/imgs/user-guide/administration/user/user-manage.png alt=user-manage></p><p>2、点击【新增用户】，填写用户信息。</p><p><img src=/imgs/user-guide/administration/user/user-add.png alt=user-add></p><ul><li>登录账号：<ul><li>不能超过253个字符；</li><li>只能包含小写字母、数字，以及'-' 和 &lsquo;.'；</li><li>须以字母数字开头；</li><li>须以字母数字结尾；</li><li>全局唯一标识，不允许重复，不允许修改。</li></ul></li><li>用户名：<ul><li>平台内展示的用户名，默认为登录账号。</li></ul></li><li>密码：<ul><li>长度不得少于8位且不大于20位；</li><li>至少应包括字母、数字以及特殊符号中两类。</li></ul></li><li>电话：<ul><li>符合中国手机号规范，如188****1234；</li><li>选填。</li></ul></li><li>Email：<ul><li>符合日常邮件地址规范；</li><li>选填。</li></ul></li></ul><p>点击【确定】，即创建该用户。</p><p>3、如果需要批量创建用户，可以点击【批量导入】-【下载模版】，填写表格内容后上传文件，即可批量创建表格内填写的用户。表格填写规范同上。</p><p><img src=/imgs/user-guide/administration/user/user-import.png alt=user-import></p><h2 id=用户管理>用户管理</h2><p>使用平台管理员账号登录 KubeCube 后，展开【组织管理】菜单，点击【用户管理】，进入用户管理页面。</p><p><img src=/imgs/user-guide/administration/user/user-manage.png alt=user-manage></p><p>在用户管理页面，可以看到平台内的所有用户，包括每个用户的登录账号、用户名、类型、状态、上次登录IP以及上次登录时间。</p><ul><li>类型：用户的登录方式，如果是使用账号密码登录，则类型为 &ldquo;normal&rdquo;；如果为其他登录方式，如LDAP、Github等通过第三方平台认证登录，则类型为对应的第三方平台名称。目前 KubeCube 只支持密码登录方式。</li><li>状态：分为启用和禁用，启用状态用户可正常登录，禁用状态用户不可登录。</li></ul><p>同时，平台管理员可以在该界面修改用户信息，包括用户密码、用户名、电话以及 Email，规范同上。用户登录账号不支持修改。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-cc16e9ac86342c7d9c5ab1f4a64571b9>2 - 租户管理</h1><p>本文档介绍了如何在 KubeCube 上进行租户管理，并管理租户下的项目和成员。</p><h2 id=准备工作>准备工作</h2><p>使用平台管理员或租户管理员账号登录 KubeCube。</p><h2 id=租户管理>租户管理</h2><h3 id=新增租户>新增租户</h3><p>1、使用平台管理员账号登录 KubeCube，展开【组织管理】菜单，点击【租户管理】，进入租户管理页面。</p><p>2、点击【新增租户】，填写租户信息。</p><p><img src=/imgs/user-guide/administration/tenant/add-tenant.png alt=tenant-manage></p><ul><li>租户名称：平台内展示的租户名。</li><li>租户标识：<ul><li>长度不得少于2位且不大于32位；</li><li>只能包含小写字母、数字，以及中划线 &lsquo;-&rsquo; ；</li><li>全局唯一标识，不允许重复，不允许修改。</li></ul></li></ul><h3 id=租户管理-1>租户管理</h3><p>使用平台管理员账号登录 KubeCube，展开【组织管理】菜单，点击【租户管理】，进入租户管理页面，可以查看到平台下所有的租户；使用租户管理员账号登录，进入租户管理页面，可以查看到该租户管理员所管理的所有租户。</p><p>同时可以在该界面快捷添加成员、添加项目、修改租户名称。</p><p><img src=/imgs/user-guide/administration/tenant/tenant-manage.png alt=tenant-manage></p><h2 id=项目管理>项目管理</h2><p>在租户管理页面点击上方的【项目】，切换到项目管理页面。</p><p><img src=/imgs/user-guide/administration/tenant/project-manage.png alt=project-manage></p><p>点击【新增项目】，即可添加项目：</p><ul><li>所属租户：选择权限内的已有租户；</li><li>项目名称：项目的展示名称；</li><li>项目标识：<ul><li>长度不得少于2位且不大于32位；</li><li>只能包含小写字母、数字，以及中划线 &lsquo;-&rsquo; ；</li><li>全局唯一标识，不允许重复，不允许修改。</li></ul></li><li>项目描述：对该项目的描述性语言。</li></ul><p>添加项目成功后，也可以在该页面直接为该项目或其他项目添加项目成员。</p><h2 id=成员管理>成员管理</h2><p>在租户管理页面点击上方的到【成员】，切换到成员管理页面。</p><p><img src=/imgs/user-guide/administration/tenant/member-manage.png alt=member-manage></p><p>点击【添加成员】，即可为指定的租户或项目添加成员。</p><ul><li>所属租户：选择权限内的租户；</li><li>所属项目：选择所选租户下的项目，如果选择【不指定】，则为添加租户成员，否则为项目成员；</li><li>账号：选择平台内的用户；</li><li>角色：指定所选用户的角色，如果【所属项目】选择【不指定】，则角色可设置为租户管理员或普通成员；如果【所属项目】选择具体项目，则角色可设置为项目管理员或普通成员。</li></ul><p>添加成员成功后，可以在该页面进行租户成员和项目成员的管理。同时可以在右上方，根据租户、项目、角色对成员进行过滤和搜索。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-e2d94e3b74b28c3cb9df52bbf9ca00b2>3 - 角色管理</h1><p>KubeCube 的角色管理基于 Kubernetes 的 RBAC 实现，对多集群提供了统一的认证鉴权功能</p><h2 id=内置角色>内置角色</h2><p>KubeCube 针对不同的层级，内置了相应的管理员角色和只有读权限的 reviewer 角色</p><table><thead><tr><th>权限\角色</th><th>platform-admin</th><th>tenant-admin</th><th>project-admin</th><th>reviewer</th></tr></thead><tbody><tr><td>集群管理</td><td>✓</td><td></td><td></td><td></td></tr><tr><td>角色管理</td><td>✓</td><td></td><td></td><td></td></tr><tr><td>角色查看</td><td>✓</td><td>✓</td><td>✓</td><td></td></tr><tr><td>用户管理</td><td>✓</td><td></td><td></td><td></td></tr><tr><td>节点管理</td><td>✓</td><td></td><td></td><td></td></tr><tr><td>所有租户管理</td><td>✓</td><td></td><td></td><td></td></tr><tr><td>所有租户成员管理</td><td>✓</td><td></td><td></td><td></td></tr><tr><td>本租户管理</td><td>✓</td><td>✓</td><td></td><td></td></tr><tr><td>本租户成员管理</td><td>✓</td><td>✓</td><td></td><td></td></tr><tr><td>所有项目管理</td><td>✓</td><td></td><td></td><td></td></tr><tr><td>所有项目成员管理</td><td>✓</td><td></td><td></td><td></td></tr><tr><td>租户下项目管理</td><td>✓</td><td>✓</td><td></td><td></td></tr><tr><td>租户下项目成员管理</td><td>✓</td><td>✓</td><td></td><td></td></tr><tr><td>本项目管理</td><td>✓</td><td>✓</td><td>✓</td><td></td></tr><tr><td>本项目成员管理</td><td>✓</td><td>✓</td><td>✓</td><td></td></tr><tr><td>管理 namespace</td><td>✓</td><td></td><td></td><td></td></tr><tr><td>管理工作负载</td><td>✓</td><td>✓</td><td>✓</td><td></td></tr><tr><td>管理卷</td><td>✓</td><td>✓</td><td>✓</td><td></td></tr><tr><td>管理 service</td><td>✓</td><td>✓</td><td>✓</td><td></td></tr><tr><td>管理 ingress</td><td>✓</td><td>✓</td><td>✓</td><td></td></tr><tr><td>管理 secrets</td><td>✓</td><td>✓</td><td>✓</td><td></td></tr><tr><td>管理 serviceaccout</td><td>✓</td><td>✓</td><td>✓</td><td></td></tr><tr><td>管理 subnamespaceanchor</td><td>✓</td><td>✓</td><td>✓</td><td></td></tr><tr><td>查看工作负载</td><td>✓</td><td>✓</td><td>✓</td><td>✓</td></tr><tr><td>查看卷</td><td>✓</td><td>✓</td><td>✓</td><td>✓</td></tr><tr><td>查看 service</td><td>✓</td><td>✓</td><td>✓</td><td>✓</td></tr><tr><td>查看 ingress</td><td>✓</td><td>✓</td><td>✓</td><td>✓</td></tr><tr><td>查看 secrets</td><td>✓</td><td>✓</td><td>✓</td><td>✓</td></tr><tr><td>查看 serviceaccout</td><td>✓</td><td>✓</td><td>✓</td><td>✓</td></tr><tr><td>查看 subnamespaceanchor</td><td>✓</td><td>✓</td><td>✓</td><td>✓</td></tr></tbody></table><blockquote><p>KubeCube 使用 <a href=https://github.com/kubernetes-sigs/hierarchical-namespaces>HNC</a> 来实现 tenant、project 和 namespace 的层级，以及彼此之间的隔离；为了实现 namespace 层级的隔离，除 platform-admin 外所有角色，通过 subnamespaceanchor 资源来管理 namespace</p></blockquote><h2 id=管理角色>管理角色</h2><p>通过角色标签栏来选择角色层级，点击【添加角色】来新建自定义角色，【继承已有】会以本层级的 admin 角色为模版新建出角色，【自定义】可以自定义编辑新角色</p><p><img src=/imgs/user-guide/administration/role/add-role.png alt=add-role.png></p><p>通过勾选具体的权限项来自定义角色的权限，点击【修改】提交修改</p><p><img src=/imgs/user-guide/administration/role/mgr-role.png alt=mgr-role.png></p></div><div class=td-content style=page-break-before:always><h1 id=pg-0a268df46e46cb89462ce4c8762d20b6>4 - 配额管理</h1><p>KubeCube 在 Kubernetes 原生的资源配额能力上进行了拓展，在租户层级即可对资源配额进行限制，在使用体验上与 Kubernetes 原生的 ResouceQuota 保持一致</p><blockquote><p>KubeCube 目前支持对 nvidia gpu 进行资源配额</p></blockquote><h2 id=资源配额结构>资源配额结构</h2><p><img src=/imgs/user-guide/administration/quota/resourcequota.png alt=resourcequota.png></p><p>资源配额的计算结构遵循以下约束：</p><ol><li>租户下 namespace 的资源配额总和 &lt; 租户配额</li><li>集群下租户的资源配额总和 &lt; 集群的物理资源</li></ol><blockquote><p>CubeResourceQuota 是 KubeCube 对于 namespace 级别的 ResourceQuota 的上层抽象，基于 CRD 实现</p></blockquote><h2 id=tenant-资源配额>Tenant 资源配额</h2><h3 id=前置要求>前置要求</h3><p>创建一个租户</p><h3 id=设置租户的资源配额>设置租户的资源配额</h3><p>选择租户，点击【调整配额】对指定集群下的租户进行资源配额的设置</p><p><img src=/imgs/user-guide/administration/quota/tenant-quota.png alt=tenant-quota.png></p><p>在可填框中填入期望设置的资源配额，点击【确定】保存配额设置</p><ul><li>【集群可分配】表示该集群剩余可分配资源</li><li>【租户已分配】表示该租户下所有 namespace 已分配的资源总和</li></ul><p><img src=/imgs/user-guide/administration/quota/modify-tenant-quota.png alt=modify-tenant-quota.png></p><h2 id=创建-namespace-并设置资源配额>创建 Namespace 并设置资源配额</h2><h3 id=前置要求-1>前置要求</h3><p>创建一个租户，在租户下创建项目</p><h3 id=设置-namespace-的资源配额>设置 namespace 的资源配额</h3><p>点击右上方【租户】选择框，选择租户，点击【创建空间】创建新的 namespace 并设置资源配额，也可以点击【修改】对已创建的 namespace 的资源配额进行修改</p><p><img src=/imgs/user-guide/administration/quota/ns-quota.png alt=ns-quota.png></p><p>创建 namespace 时，需要选择空间所属的集群、租户、项目，namespace 一旦创建，其所属关系不能更改。在可填框中填入期望的资源配额，点击【确定】使资源配额生效</p><p>【租户可分配】表示该 namespace 所属的租户所剩的可分配资源配额</p><p><img src=/imgs/user-guide/administration/quota/modify-ns-quota.png alt=modify-ns-quota.png></p></div><div class=td-content style=page-break-before:always><h1 id=pg-2306a8e0d2dc86a646a28d1621010f14>5 - K8s集群管理</h1></div><div class=td-content><h1 id=pg-62bae3e56f26c43c795878e3d6435987>5.1 - 多集群管理</h1><p>KubeCube 提供多集群管理的能力，可以基于管控集群添加或者删除集群，并对所有接管的集群提供统一的认证和鉴权入口</p><blockquote><p>⚠️ 计算集群信息不允许修改，若有修改需求，请先删除计算集群再重新添加，该操作存在的一定风险，删除计算集群期间，计算集群所有资源不受管控集群管控，认证和鉴权功能暂时关闭，直到该集群被重新添加</p></blockquote><h2 id=查看集群信息>查看集群信息</h2><p>选择集群查看对应的基本信息，Node、StorageClass、NetworkPolicy 以及 PV</p><p><img src=/imgs/user-guide/administration/k8s-cluster/multi-k8s-cluster-mgr/cluster-inspect.png alt=cluster-inspect></p><h2 id=添加计算集群>添加计算集群</h2><p><a href=https://www.kubecube.io/docs/installation-guide/add-member-k8s/#%E6%96%B9%E5%BC%8F%E4%B8%80%E9%83%A8%E7%BD%B2%E6%96%B0%E9%9B%86%E7%BE%A4%E5%B9%B6%E6%B7%BB%E5%8A%A0>部署新集群并添加</a></p><p><a href=https://www.kubecube.io/docs/installation-guide/add-member-k8s/#%E6%96%B9%E5%BC%8F%E4%BA%8C%E7%BA%B3%E7%AE%A1%E5%B7%B2%E6%9C%89%E9%9B%86%E7%BE%A4>纳管已有集群</a></p><h2 id=删除计算集群>删除计算集群</h2><p>点击【删除配置】来删除计算集群，管控集群无法通过 Console 删除。删除计算集群意味着 KubeCube 控制面不再接管该集群，该集群恢复被接管前的样子，集群上运行的工作负载、服务等不会受到影响，可以通过添加该集群来重新接管</p><p><img src=/imgs/user-guide/administration/k8s-cluster/multi-k8s-cluster-mgr/cluster-manager.png alt=cluster-manager></p></div><div class=td-content style=page-break-before:always><h1 id=pg-5b8c71fac214fcac2dcfe6ebb573c677>5.2 - 集群级资源管理</h1></div><div class=td-content><h1 id=pg-b58c5b5952e588cce8ddd5fcb7b7c0cc>5.2.1 - 存储类别(StorageClass)</h1><p>KubeCube 提供对 k8s <a href=https://kubernetes.io/zh/docs/concepts/storage/storage-classes/>StorageClass</a> 资源的原生管理能力</p><h2 id=查看-storageclass>查看 StorageClass</h2><p>点击【集群管理】，选择需要查看的集群，点击【存储类别】，查看该集群中所有的 StorageClass，可以在右上角搜索栏中输入资源名称进行模糊匹配，点击【删除】可删除此 StorageClass</p><p><img src=/imgs/user-guide/administration/k8s-cluster/cluster-scoped-res/StorageClass/view-storageclass.png alt=view-storageclass></p><h2 id=创建-storageclass>创建 StorageClass</h2><p>点击【创建存储类别】来创建新的 StorageClass</p><p><img src=/imgs/user-guide/administration/k8s-cluster/cluster-scoped-res/StorageClass/create-storageclass.png alt=create-storageclass></p></div><div class=td-content style=page-break-before:always><h1 id=pg-84021fcd47af24336b3f2fa251e11490>5.2.2 - 存储声明(PV)</h1><p><a href=https://kubernetes.io/zh/docs/concepts/storage/persistent-volumes/>PersistentVolume</a> 应该由集群管理员事先提供，KubeCube 对其拥有查看和删除的能力</p><h2 id=查看-persistentvolume>查看 PersistentVolume</h2><p>点击【集群管理】，选择需要查看的集群，点击【持久存储】来查看 PersistentVolume 详情，点击【删除】可以删除该资源</p><p><img src=/imgs/user-guide/administration/k8s-cluster/cluster-scoped-res/PV/pv.png alt=pv></p><p><img src=/imgs/user-guide/administration/k8s-cluster/cluster-scoped-res/PV/pv-view.png alt=pv-view></p></div><div class=td-content style=page-break-before:always><h1 id=pg-2faeb51dc0a9f8f4133fba56d59316c3>5.2.3 - 集群节点(Node)</h1><p>KubeCube 支持集群管理员通过 Console 页面管理各集群的 Node，也支持集群管理员直接使用黑屏操作对 各集群 Node 进行管理</p><h2 id=查看节点信息>查看节点信息</h2><p>点击 Node 名称来查看节点的具体信息，点击【更多】查看 Node 的所有标签，</p><p><img src=/imgs/user-guide/administration/k8s-cluster/cluster-scoped-res/Node/node-info.png alt=node-info></p><h2 id=添加节点>添加节点</h2><p>KubeCube 支持集群管理员通过黑屏操作来自行添加节点，也可以点击【添加节点】来使用 KubeCube 的脚本来进行节点添加</p><p>// todo：确认 master 和 node 节点的添加细节</p><p><img src=/imgs/user-guide/administration/k8s-cluster/cluster-scoped-res/Node/add-node.png alt=add-node></p><h2 id=节点操作>节点操作</h2><p>点击【编辑标签】来对节点的标签进行编辑</p><p><img src=/imgs/user-guide/administration/k8s-cluster/cluster-scoped-res/Node/edit-node.png alt=edit-labels></p><p>点击【禁止调度】来限制 pod 调度到该节点</p><p><img src=/imgs/user-guide/administration/k8s-cluster/cluster-scoped-res/Node/no-schedual.png alt=no-schedual></p><p>点击【更多】来对节点进行更多高级操作，包括：设置节点类型、设置污点、平滑迁移等</p><p><img src=/imgs/user-guide/administration/k8s-cluster/cluster-scoped-res/Node/edit-node.png alt=edit-node></p></div><div class=td-content style=page-break-before:always><h1 id=pg-cb1dd5ef4d6788bbe75c885d770b9a12>5.2.4 - 网络策略(NetworkPolicy)</h1><p><a href=https://kubernetes.io/zh/docs/concepts/services-networking/network-policies/>NetworkPolicy</a> 依赖 CNI 实现，创建一个 NetworkPolicy 资源对象而没有控制器来使它生效的话，是没有任何作用的，KubeCube 默认使用 calico</p><h2 id=查看-networkpolicy>查看 NetworkPolicy</h2><p>点击【集群管理】，选择要操作的集群，点击【网络策略】，点击【查看详情】可以查看 NetworkPolicy 的详细描述，点击【设置】可以对 NetworkPolicy 进行修改，点击【删除】可以删除该资源</p><p><img src=/imgs/user-guide/administration/k8s-cluster/cluster-scoped-res/NetworkPolicy/view-networkpolicy.png alt=view-networkpolicy></p><h2 id=创建-networkpolicy>创建 NetworkPolicy</h2><p>点击【创建网络策略】可以创建新的 NetworkPolicy</p><p><img src=/imgs/user-guide/administration/k8s-cluster/cluster-scoped-res/NetworkPolicy/create-networkpolicy.png alt=create-networkpolicy></p></div><div class=td-content style=page-break-before:always><h1 id=pg-4de4ac3e2c973d54322dc28a04e64999>6 - 操作审计</h1><p>本文档介绍了如何在 KubeCube 上查询和导出操作审计日志。</p><h2 id=准备工作>准备工作</h2><p>使用平台管理员账号登录 KubeCube。</p><h2 id=开启操作审计>开启操作审计</h2><p>部署好 KubeCube 后，操作审计功能默认开启。如果需要关闭或开启操作审计功能：</p><p>1、使用平台管理员账号登录 KubeCube；</p><p>2、点击页面右上角【切换到控制台】，点击任意空间，进入到控制台页面；</p><p>3、在左侧菜单栏点击【自定义资源CRD】，进入到集群级别 CRD 列表，可以点击右上方输入 &ldquo;hotplug&rdquo; 进行搜索，找到 “hotplugs.hotplug.kubecube.io” CRD，点击【v1】版本进入 CRD 详情页；</p><p>4、选择 common 实例，点击【设置YAML】，找到 spec.component.name=audit，将 “status” 改成 “disabled”，即关闭审计功能；改为 “enabled”，为开启审计功能。详细配置说明见 <a href=https://www.kubecube.io/docs/installation-guide/enable-plugins/>热插拔</a> 。</p><p>5、配置 ElasticSearch：</p><ul><li><p>如果需要安装内置 ElasticSearch，修改上述 common 实例，找到 spec.component.name=elasticsearch，将 “status” 改成 “enabled”，在集群内安装 ElasticSearch。</p></li><li><p>如果需要连接外部 ElasticSearch，需要修改审计服务的deployment的环境变量：</p><ol><li><p><code>kubectl edit deploy audit -n kubecube-system</code></p></li><li><p>添加环境变量：AUDIT_WEBHOOK_HOST、AUDIT_WEBHOOK_INDEX、AUDIT_WEBHOOK_TYPE，如</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#204a87;font-weight:700>env</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AUDIT_WEBHOOK_HOST</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://elasticsearch-master.elasticsearch:9200</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AUDIT_WEBHOOK_INDEX</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>audit</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AUDIT_WEBHOOK_TYPE</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>logs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div></li></ol></li><li><p>如果同时配置了内部和外部 ElasticSearch，优先将审计日志发到外部 ElasticSearch。</p></li></ul><h2 id=查询审计日志>查询审计日志</h2><p>使用平台管理员账号登录 KubeCube 后，展开【管控运维】菜单，点击【操作审计】，进入操作审计页面。</p><p><img src=/imgs/user-guide/administration/audit/audit-manage.png alt=audit-manage></p><p>如图所示，在该页面展示出了所有的审计日志，包括审计操作者的账号、操作的时间、IP地址、事件名称、资源、状态。同时平台管理员也可以根据账号、IP地址等进行过滤查询。</p><h2 id=导出审计日志>导出审计日志</h2><p>在操作审计页面，对审计日志查询后，点击【导出】，即可对查询结果进行导出。导出文件格式为csv，导出的日志条数默认不超过10000条。</p></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/kubecube-io/kubecube aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2024 KubeCube Project Authors All Rights Reserved</small>
<small class=ml-1><a href=http://www.apache.org/licenses/LICENSE-2.0 target=_blank rel=noopener>隐私政策</a></small></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script><script src=/js/main.min.3b172c13b62c2bea8b1c9d2599cddc8cf89718a92d792c680871c81ba43d8c85.js integrity="sha256-OxcsE7YsK+qLHJ0lmc3cjPiXGKkteSxoCHHIG6Q9jIU=" crossorigin=anonymous></script></body></html>